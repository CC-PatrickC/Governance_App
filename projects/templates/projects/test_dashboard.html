{% extends 'base_cc.html' %}
{% load static %}
{% load project_tags %}

{% block title %}Test Dashboard{% endblock %}

{% block extra_css %}
<style>
/* Force equal heights for test dashboard cards */
.test-dashboard .row {
    display: flex !important;
    flex-wrap: wrap !important;
}

.test-dashboard .row > .col-md-4 {
    display: flex !important;
    flex-direction: column !important;
}

.test-dashboard .row > .col-md-4 > .card {
    height: 550px !important;
    display: flex !important;
    flex-direction: column !important;
    margin-bottom: 1rem !important;
}

.test-dashboard .row > .col-md-4 > .card > .card-body {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    padding: 1rem !important;
}

.test-dashboard .row > .col-md-4 > .card > .card-body > div:last-child {
    flex: 1 !important;
    height: 350px !important;
    max-height: 350px !important;
    min-height: 350px !important;
    overflow: hidden !important;
}

/* Override any inline styles on chart containers */
.test-dashboard .row > .col-md-4 > .card > .card-body > div[style*="height: 350px"] {
    height: 350px !important;
    max-height: 350px !important;
    min-height: 350px !important;
    overflow: hidden !important;
    flex: 1 !important;
}

/* Ensure table containers are also constrained */
.test-dashboard .row > .col-md-4 > .card > .card-body > .table-responsive {
    flex: 1 !important;
    overflow-y: auto !important;
    max-height: 350px !important;
}

/* Force canvas elements to respect container height */
.test-dashboard canvas {
    max-height: 350px !important;
    height: 350px !important;
}

/* Style the range slider to use CC gold */
.test-dashboard input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    background: transparent;
    cursor: pointer;
}

.test-dashboard input[type="range"]::-webkit-slider-track {
    background: #e9ecef;
    height: 6px;
    border-radius: 3px;
}

.test-dashboard input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    background: #D09B2C;
    height: 18px;
    width: 18px;
    border-radius: 50%;
    cursor: pointer;
}

.test-dashboard input[type="range"]::-moz-range-track {
    background: #e9ecef;
    height: 6px;
    border-radius: 3px;
    border: none;
}

.test-dashboard input[type="range"]::-moz-range-thumb {
    background: #D09B2C;
    height: 18px;
    width: 18px;
    border-radius: 50%;
    cursor: pointer;
    border: none;
}


</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4 test-dashboard">
    <h1 class="mb-4">Test Dashboard</h1>
    
    <!-- Latest 5 Requests -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                                 <div class="card-body">
                     <div class="d-flex justify-content-between align-items-center mb-3">
                         <h5 class="card-title mb-0">Latest Requests</h5>
                         <div class="btn-group" role="group" aria-label="Request count filters">
                             <button type="button" class="btn btn-sm active" id="btnLast5" style="background-color: #D09B2C; border-color: #D09B2C; color: white;">
                                 Last 5
                             </button>
                             <button type="button" class="btn btn-sm" id="btnLast10" style="border-color: #D09B2C; color: #D09B2C;">
                                 Last 10
                             </button>
                             <button type="button" class="btn btn-sm" id="btnLast20" style="border-color: #D09B2C; color: #D09B2C;">
                                 Last 20
                             </button>
                         </div>
                     </div>
                                          {% if recent_projects %}
                         <div class="table-responsive" style="height: 350px; overflow-y: auto;">
                             <table class="table table-hover">
                                <thead style="position: sticky; top: 0; background: white; z-index: 1;">
                                    <tr>
                                        <th>Project #</th>
                                        <th>Title</th>
                                        <th>Department</th>
                                        <th>Status</th>
                                        <th>Submitted</th>
                                    </tr>
                                </thead>
                                                                 <tbody id="requestsTableBody">
                                     {% for project in recent_projects %}
                                     <tr class="request-row" data-index="{{ forloop.counter0 }}">
                                         <td>{{ project.formatted_id }}</td>
                                         <td>{{ project.title }}</td>
                                         <td>{{ project.department }}</td>
                                         <td>{{ project.get_status_display }}</td>
                                         <td>{{ project.submission_date|date:"M d, Y" }}</td>
                                     </tr>
                                     {% endfor %}
                                 </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted">No recent requests found.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Active Requests per Department Bar Graph -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                                         <h5 class="card-title">Requests per Department</h5>
                     <div style="height: 350px;">
                         <canvas id="departmentChart"></canvas>
                     </div>

                </div>
            </div>
        </div>
        
        <!-- Status Distribution Pie Chart -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                                         <h5 class="card-title">Request Status Distribution</h5>
                     <div style="height: 350px;">
                         <canvas id="statusChart"></canvas>
                     </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Priority Projects Section -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-3">Priority Requests</h5>
                                         {% if priority_sorted_projects %}
                         <div class="table-responsive" style="height: 350px; overflow-y: auto;">
                             <table class="table table-hover">
                                <thead style="position: sticky; top: 0; background: white; z-index: 1;">
                                    <tr>
                                        <th>Project #</th>
                                        <th>Title</th>
                                        <th>Department</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="priorityTableBody">
                                    {% for project in priority_sorted_projects %}
                                    <tr>
                                        <td>{{ project.formatted_id }}</td>
                                        <td>{{ project.title }}</td>
                                        <td>{{ project.department }}</td>
                                        <td>{{ project.priority }}</td>
                                        <td>{{ project.get_status_display }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted">No priority requests found.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Daily Requests Line Chart -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                                         <div class="d-flex justify-content-between align-items-center mb-3">
                         <h5 class="card-title mb-0" id="requestsChartTitle">Requests by Month</h5>
                     </div>
                     
                     <!-- Month Range Slider -->
                     <div class="mb-3">
                         <div class="d-flex justify-content-between align-items-center mb-2">
                             <small class="text-muted">Month Range Filter (12 months from selected month)</small>
                         </div>
                         <div class="position-relative">
                             <input type="range" id="monthSlider" class="form-range" min="0" max="17" value="17" style="width: 100%;">
                             <div class="d-flex justify-content-between mt-1">
                                 <small class="text-muted" id="sliderStartMonth">18 months ago</small>
                                 <small class="text-muted" id="sliderEndMonth">Current month</small>
                             </div>
                         </div>
                     </div>
                    
                    
                    
                                         <div style="height: 350px;">
                         <canvas id="dailyChart"></canvas>
                     </div>
                </div>
            </div>
        </div>
        
                 <!-- Department Requests by Year Stacked Bar Chart -->
         <div class="col-md-4">
             <div class="card">
                 <div class="card-body">
                     <h5 class="card-title">Department Requests by Year</h5>
                     <div style="height: 350px;">
                         <canvas id="departmentYearChart"></canvas>
                     </div>
                 </div>
             </div>
         </div>
    </div>

    <!-- Main Content Area - Ready for items to be added one by one -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Dashboard Content</h5>
                    <p class="text-muted">Main dashboard content will be added here.</p>
                    <!-- Content will be added here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // Department Chart
    console.log('Starting chart creation...');
    
    // Simple test to see if Chart.js is working
    console.log('Chart.js available:', typeof Chart !== 'undefined');
    console.log('Department chart canvas:', document.getElementById('departmentChart'));
    
    try {
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            throw new Error('Chart.js not loaded');
        }
        
        // Get the canvas element
        const canvas = document.getElementById('departmentChart');
        if (!canvas) {
            throw new Error('Canvas element not found');
        }
        
        // Destroy any existing chart on this canvas
        const existingChart = Chart.getChart(canvas);
        if (existingChart) {
            console.log('Destroying existing chart');
            existingChart.destroy();
        }
        
        // Department data from Django
        const departmentData = {{ department_counts|safe }};
        console.log('Department data:', departmentData);
        
        const departments = Object.keys(departmentData);
        const counts = Object.values(departmentData);
        
        console.log('Departments:', departments);
        console.log('Counts:', counts);
        
        if (departments.length === 0) {
            throw new Error('No department data available');
        }
        
        // Create the chart
        const ctx = canvas.getContext('2d');
        console.log('Canvas context:', ctx);
        
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: departments,
                datasets: [{
                    label: 'Active Requests',
                    data: counts,
                    backgroundColor: '#D09B2C',
                    borderColor: '#D09B2C',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        },
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
        
        console.log('Chart created successfully:', chart);
        
    } catch (error) {
        console.error('Chart creation error:', error);
        const chartContainer = document.getElementById('departmentChart');
        if (chartContainer && chartContainer.parentElement) {
            chartContainer.parentElement.innerHTML = `<p class="text-muted text-center mt-4">Error loading chart: ${error.message}</p>`;
        } else {
            console.error('Could not find chart container to show error message');
        }
    }
    
    // Daily Requests Line Chart
    console.log('Starting daily chart creation...');
    
    try {
        // Check if Chart.js is loaded
        if (typeof Chart === 'undefined') {
            throw new Error('Chart.js not loaded');
        }
        
        // Get the canvas element
        const dailyCanvas = document.getElementById('dailyChart');
        if (!dailyCanvas) {
            throw new Error('Daily chart canvas element not found');
        }
        
        // Destroy any existing chart on this canvas
        const existingDailyChart = Chart.getChart(dailyCanvas);
        if (existingDailyChart) {
            console.log('Destroying existing daily chart');
            existingDailyChart.destroy();
        }
        
        // Daily data from Django
        const dailyData = {{ daily_data|safe }};
        console.log('Daily data:', dailyData);
        
                 // Function to get 12 months of data from a specific end month
         function get12MonthsData(endMonthIndex = 17) {
             const currentDate = new Date();
             const endDate = new Date(currentDate);
             endDate.setMonth(currentDate.getMonth() - (17 - endMonthIndex)); // Adjust based on slider position
             
             const startDate = new Date(endDate);
             startDate.setMonth(endDate.getMonth() - 11); // 12 months back from selected end month
             
             const filteredData = {};
             Object.keys(dailyData).forEach(dateStr => {
                 const date = new Date(dateStr);
                 if (date >= startDate && date <= endDate) {
                     filteredData[dateStr] = dailyData[dateStr];
                 }
             });
             return filteredData;
         }
         
         // Function to generate month labels for 18 months
         function generateMonthLabels() {
             const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
             const labels = [];
             const currentDate = new Date();
             
             for (let i = 17; i >= 0; i--) {
                 const date = new Date(currentDate);
                 date.setMonth(currentDate.getMonth() - i);
                 const month = date.getMonth();
                 const year = date.getFullYear();
                 labels.push(`${monthNames[month]} ${year}`);
             }
             
             return labels;
         }
         
         // Function to update slider labels
         function updateSliderLabels() {
             const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
             const currentDate = new Date();
             
             // Start month (18 months ago)
             const startDate = new Date(currentDate);
             startDate.setMonth(currentDate.getMonth() - 17);
             const startMonth = monthNames[startDate.getMonth()];
             const startYear = startDate.getFullYear();
             
             // End month (current month)
             const endMonth = monthNames[currentDate.getMonth()];
             const endYear = currentDate.getFullYear();
             
             document.getElementById('sliderStartMonth').textContent = `${startMonth} ${startYear}`;
             document.getElementById('sliderEndMonth').textContent = `${endMonth} ${endYear}`;
         }
        
        
        
                 // Function to create chart with filtered data
         function createDailyChart(data, endMonthIndex = 17) {
             // Aggregate data by month-year for 12 months view
             const monthlyData = {};
             const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
             
             Object.keys(data).forEach(dateStr => {
                 const date = new Date(dateStr);
                 const month = date.getMonth();
                 const year = date.getFullYear();
                 const monthKey = `${month}-${year}`;
                 const monthLabel = `${monthNames[month]} ${year}`;
                 
                 if (!monthlyData[monthKey]) {
                     monthlyData[monthKey] = {
                         label: monthLabel,
                         count: 0
                     };
                 }
                 monthlyData[monthKey].count += data[dateStr] || 0;
             });
             
             // Calculate the end date based on slider position
             const currentDate = new Date();
             const endDate = new Date(currentDate);
             endDate.setMonth(currentDate.getMonth() - (17 - endMonthIndex));
             
             // Calculate start date (12 months back from selected end date)
             const startDate = new Date(endDate);
             startDate.setMonth(endDate.getMonth() - 11);
             
             // Generate all 12 months from start to end date
             const allMonths = [];
             const currentMonth = new Date(startDate);
             
             for (let i = 0; i < 12; i++) {
                 const month = currentMonth.getMonth();
                 const year = currentMonth.getFullYear();
                 const monthKey = `${month}-${year}`;
                 const monthLabel = `${monthNames[month]} ${year}`;
                 
                 allMonths.push({
                     key: monthKey,
                     label: monthLabel,
                     count: monthlyData[monthKey] ? monthlyData[monthKey].count : 0
                 });
                 
                 // Move to next month
                 currentMonth.setMonth(currentMonth.getMonth() + 1);
             }
             
             const labels = allMonths.map(month => month.label);
             const counts = allMonths.map(month => month.count);
             
             if (labels.length === 0) {
                 throw new Error('No data available for selected time period');
             }
             
             // Create the line chart
             const dailyCtx = dailyCanvas.getContext('2d');
             console.log('Daily canvas context:', dailyCtx);
             
             const dailyChart = new Chart(dailyCtx, {
                 type: 'line',
                 data: {
                     labels: labels,
                     datasets: [{
                         label: 'Requests',
                         data: counts,
                         borderColor: '#D09B2C',
                         backgroundColor: 'rgba(208, 155, 44, 0.1)',
                         borderWidth: 2,
                         fill: true,
                         tension: 0.4,
                         pointBackgroundColor: '#D09B2C',
                         pointBorderColor: '#D09B2C',
                         pointBorderWidth: 2,
                         pointRadius: 4,
                         pointHoverRadius: 6
                     }]
                 },
                 options: {
                     responsive: true,
                     maintainAspectRatio: false,
                     scales: {
                         y: {
                             beginAtZero: true,
                             ticks: {
                                 stepSize: 1,
                                 precision: 0
                             },
                             grid: {
                                 display: false
                             }
                         },
                         x: {
                             grid: {
                                 display: false
                             }
                         }
                     },
                     plugins: {
                         legend: {
                             display: false
                         }
                     }
                 }
             });
             
             console.log('Daily chart created successfully:', dailyChart);
             return dailyChart;
         }
        
                 // Initialize slider labels
         updateSliderLabels();
         
         // Initialize with 12 months data (current month as end)
         let currentDailyChart = createDailyChart(get12MonthsData(17), 17);
         
         console.log('Daily chart initialized with 12 months data');
         
         // Add slider event listener
         const monthSlider = document.getElementById('monthSlider');
         if (monthSlider) {
             monthSlider.addEventListener('input', function() {
                 const sliderValue = parseInt(this.value);
                 console.log('Slider moved to position:', sliderValue);
                 
                 // Destroy existing chart
                 if (currentDailyChart) {
                     currentDailyChart.destroy();
                 }
                 
                 // Recreate chart with new data
                 try {
                     currentDailyChart = createDailyChart(get12MonthsData(sliderValue), sliderValue);
                 } catch (error) {
                     console.error('Error updating chart:', error);
                     const chartDiv = document.querySelector('.card-body div[style*="height: 350px"]');
                     if (chartDiv) {
                         chartDiv.innerHTML = `<p class="text-muted text-center mt-4">No data available for selected time period</p>`;
                     }
                 }
             });
         }
        

        

        

        
        
    } catch (error) {
        console.error('Daily chart creation error:', error);
        const dailyChartContainer = document.getElementById('dailyChart');
        if (dailyChartContainer && dailyChartContainer.parentElement) {
            dailyChartContainer.parentElement.innerHTML = `<p class="text-muted text-center mt-4">Error loading daily chart: ${error.message}</p>`;
        } else {
            console.error('Could not find daily chart container to show error message');
        }
    }
    
    // Status Pie Chart
    console.log('Starting status pie chart creation...');
    
    try {
        // Get the canvas element for status chart
        const statusCanvas = document.getElementById('statusChart');
        if (!statusCanvas) {
            throw new Error('Status chart canvas element not found');
        }
        
        // Destroy any existing chart on this canvas
        const existingStatusChart = Chart.getChart(statusCanvas);
        if (existingStatusChart) {
            console.log('Destroying existing status chart');
            existingStatusChart.destroy();
        }
        
        // Status data from Django
        const statusData = {{ status_counts|safe }};
        console.log('Status data:', statusData);
        
        const statuses = Object.keys(statusData);
        const statusCounts = Object.values(statusData);
        
        // Add count to each status label
        const statusLabelsWithCount = statuses.map((status, index) => {
            return `${status} (${statusCounts[index]})`;
        });
        
        console.log('Statuses:', statuses);
        console.log('Status counts:', statusCounts);
        console.log('Status labels with count:', statusLabelsWithCount);
        
        if (statuses.length === 0) {
            throw new Error('No status data available');
        }
        
        // Create the pie chart
        const statusCtx = statusCanvas.getContext('2d');
        console.log('Status canvas context:', statusCtx);
        
        // Define colors for different statuses
        const statusColors = [
            '#D09B2C', // CC Gold
            '#28a745', // Green
            '#dc3545', // Red
            '#ffc107', // Yellow
            '#17a2b8', // Blue
            '#6c757d'  // Gray
        ];
        
        const statusChart = new Chart(statusCtx, {
            type: 'pie',
            data: {
                labels: statusLabelsWithCount,
                datasets: [{
                    data: statusCounts,
                    backgroundColor: statusColors.slice(0, statuses.length),
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                }
            }
        });
        
                 console.log('Status chart created successfully:', statusChart);
         
     } catch (error) {
         console.error('Status chart creation error:', error);
         const statusChartContainer = document.getElementById('statusChart');
         if (statusChartContainer && statusChartContainer.parentElement) {
             statusChartContainer.parentElement.innerHTML = `<p class="text-muted text-center mt-4">Error loading status chart: ${error.message}</p>`;
         } else {
             console.error('Could not find status chart container to show error message');
         }
     }
     
     // Department Requests by Year Stacked Bar Chart
     console.log('Starting department year stacked bar chart creation...');
     
     try {
         // Get the canvas element for department year chart
         const departmentYearCanvas = document.getElementById('departmentYearChart');
         if (!departmentYearCanvas) {
             throw new Error('Department year chart canvas element not found');
         }
         
         // Destroy any existing chart on this canvas
         const existingDepartmentYearChart = Chart.getChart(departmentYearCanvas);
         if (existingDepartmentYearChart) {
             console.log('Destroying existing department year chart');
             existingDepartmentYearChart.destroy();
         }
         
         // Department year data from Django
         const departmentYearLabels = {{ department_year_labels|safe }};
         const departmentYearDatasets = {{ department_year_datasets|safe }};
         
         console.log('Department year labels:', departmentYearLabels);
         console.log('Department year datasets:', departmentYearDatasets);
         
         if (departmentYearLabels.length === 0) {
             throw new Error('No department year data available');
         }
         
         // Create the stacked bar chart
         const departmentYearCtx = departmentYearCanvas.getContext('2d');
         console.log('Department year canvas context:', departmentYearCtx);
         
         const departmentYearChart = new Chart(departmentYearCtx, {
             type: 'bar',
             data: {
                 labels: departmentYearLabels,
                 datasets: departmentYearDatasets
             },
             options: {
                 responsive: true,
                 maintainAspectRatio: false,
                 scales: {
                     x: {
                         stacked: true,
                         grid: {
                             display: false
                         }
                     },
                     y: {
                         stacked: true,
                         beginAtZero: true,
                         ticks: {
                             stepSize: 1,
                             precision: 0
                         },
                         grid: {
                             display: false
                         }
                     }
                 },
                 plugins: {
                     legend: {
                         position: 'bottom',
                         labels: {
                             padding: 20,
                             usePointStyle: true,
                             font: {
                                 weight: 'bold'
                             }
                         }
                     }
                 }
             }
         });
         
         console.log('Department year chart created successfully:', departmentYearChart);
         
     } catch (error) {
         console.error('Department year chart creation error:', error);
         const departmentYearChartContainer = document.getElementById('departmentYearChart');
         if (departmentYearChartContainer && departmentYearChartContainer.parentElement) {
             departmentYearChartContainer.parentElement.innerHTML = `<p class="text-muted text-center mt-4">Error loading department year chart: ${error.message}</p>`;
         } else {
             console.error('Could not find department year chart container to show error message');
         }
     }
     
     // Latest Requests Table Functionality
     console.log('Setting up latest requests table functionality...');
     
     // Function to show/hide request rows based on count
     function showLatestRequests(count) {
         const rows = document.querySelectorAll('.request-row');
         const tableContainer = document.querySelector('.col-md-4:first-child .table-responsive');
         console.log(`Showing last ${count} requests out of ${rows.length} total requests`);
         console.log('Table container found:', tableContainer);
         console.log('Table container current height:', tableContainer ? tableContainer.style.height : 'not found');
         
         // First, hide all rows
         rows.forEach((row) => {
             row.style.display = 'none';
         });
         
         // Then show the requested number of rows
         rows.forEach((row, index) => {
             if (index < count) {
                 row.style.display = 'table-row';
                 console.log(`Showing row ${index + 1}`);
             }
         });
         
         // Table container now has fixed height with scroll
         if (tableContainer) {
             console.log('Table container using fixed height with scroll');
         }
         
         // Debug: count how many rows are actually visible
         const visibleRows = document.querySelectorAll('.request-row.show');
         console.log(`Actually visible rows: ${visibleRows.length}`);
     }
     
     // Initialize with last 5 requests
     setTimeout(() => {
         showLatestRequests(5);
     }, 100);
     
     // Add event listeners for request count buttons
     const btnLast5 = document.getElementById('btnLast5');
     const btnLast10 = document.getElementById('btnLast10');
     const btnLast20 = document.getElementById('btnLast20');
     
     if (btnLast5) {
         btnLast5.addEventListener('click', function() {
             console.log('Last 5 button clicked!');
             
             // Update button states
             document.getElementById('btnLast5').classList.add('active');
             document.getElementById('btnLast5').style.backgroundColor = '#D09B2C';
             document.getElementById('btnLast5').style.color = 'white';
             document.getElementById('btnLast10').classList.remove('active');
             document.getElementById('btnLast10').style.backgroundColor = '';
             document.getElementById('btnLast10').style.color = '#D09B2C';
             document.getElementById('btnLast20').classList.remove('active');
             document.getElementById('btnLast20').style.backgroundColor = '';
             document.getElementById('btnLast20').style.color = '#D09B2C';
             
             // Show last 5 requests
             setTimeout(() => {
                 showLatestRequests(5);
             }, 50);
         });
     }
     
     if (btnLast10) {
         btnLast10.addEventListener('click', function() {
             console.log('Last 10 button clicked!');
             
             // Update button states
             document.getElementById('btnLast10').classList.add('active');
             document.getElementById('btnLast10').style.backgroundColor = '#D09B2C';
             document.getElementById('btnLast10').style.color = 'white';
             document.getElementById('btnLast5').classList.remove('active');
             document.getElementById('btnLast5').style.backgroundColor = '';
             document.getElementById('btnLast5').style.color = '#D09B2C';
             document.getElementById('btnLast20').classList.remove('active');
             document.getElementById('btnLast20').style.backgroundColor = '';
             document.getElementById('btnLast20').style.color = '#D09B2C';
             
             // Show last 10 requests
             setTimeout(() => {
                 showLatestRequests(10);
             }, 50);
         });
     }
     
     if (btnLast20) {
         btnLast20.addEventListener('click', function() {
             console.log('Last 20 button clicked!');
             
             // Update button states
             document.getElementById('btnLast20').classList.add('active');
             document.getElementById('btnLast20').style.backgroundColor = '#D09B2C';
             document.getElementById('btnLast20').style.color = 'white';
             document.getElementById('btnLast5').classList.remove('active');
             document.getElementById('btnLast5').style.backgroundColor = '';
             document.getElementById('btnLast5').style.color = '#D09B2C';
             document.getElementById('btnLast10').classList.remove('active');
             document.getElementById('btnLast10').style.backgroundColor = '';
             document.getElementById('btnLast10').style.color = '#D09B2C';
             
             // Show last 20 requests
             setTimeout(() => {
                 showLatestRequests(20);
             }, 50);
         });
     }
 });
</script>
{% endblock %}
